<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anushka.ai - Advanced AI Assistant</title>
    <meta name="description" content="Multilingual AI assistant with advanced features">
    <meta name="theme-color" content="#1a1a1a">
    <style>
        :root {
            --primary-color: #6a4bc5;
            --secondary-color: #5a3bb0;
            --background-color: #f5f5f5;
            --text-color: #333;
            --card-bg: #fff;
            --input-bg: #fff;
            --border-color: #ddd;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --button-hover: #e0e0e0;
            --success-color: #4caf50;
            --error-color: #f44336;
            --warning-color: #ff9800;
            --info-color: #2196f3;
            --accent-color: #ff6b6b;
        }

        [data-theme="dark"] {
            --primary-color: #7d5cde;
            --secondary-color: #6a4bc5;
            --background-color: #121212;
            --text-color: #e0e0e0;
            --card-bg: #1e1e1e;
            --input-bg: #2d2d2d;
            --border-color: #444;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --button-hover: #333;
            --accent-color: #ff8e8e;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            position: relative;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo-icon {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-icon svg {
            width: 100%;
            height: 100%;
            fill: white;
        }

        .controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .toggle-btn {
            background: rgba(255, 255, 255, 0.15);
            border: none;
            color: white;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
            padding: 0.5rem 0.8rem;
            border-radius: 20px;
            transition: background 0.2s;
        }

        .toggle-btn:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .toggle-icon {
            font-size: 1.1rem;
        }

        .api-toggle {
            position: relative;
        }

        .api-toggle-btn {
            background: rgba(255, 255, 255, 0.15);
            border: none;
            color: white;
            padding: 0.5rem 0.8rem;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.3rem;
            transition: background 0.2s;
        }

        .api-toggle-btn:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .api-toggle-content {
            position: absolute;
            right: 0;
            top: 100%;
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 5px 15px var(--shadow-color);
            padding: 1rem;
            width: 250px;
            z-index: 100;
            display: none;
            flex-direction: column;
            gap: 0.5rem;
        }

        .api-toggle-content.show {
            display: flex;
        }

        .api-toggle-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.3rem 0;
        }

        .api-toggle-item input {
            margin-right: 0.5rem;
        }

        .toggle-all {
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
        }

        .toggle-all button {
            padding: 0.3rem 0.7rem;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            background: var(--input-bg);
            color: var(--text-color);
            cursor: pointer;
            font-size: 0.8rem;
        }

        main {
            flex: 1;
            padding: 1.5rem 1rem;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            display: flex;
            flex-direction: column;
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
            margin-bottom: 1rem;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
            padding: 0.5rem;
        }

        .message {
            padding: 1.2rem;
            border-radius: 16px;
            max-width: 85%;
            box-shadow: 0 2px 6px var(--shadow-color);
            position: relative;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            align-self: flex-end;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-bottom-right-radius: 4px;
        }

        .bot-message {
            align-self: flex-start;
            background-color: var(--card-bg);
            border-bottom-left-radius: 4px;
        }

        .feature-message {
            align-self: flex-start;
            background-color: rgba(255, 152, 0, 0.1);
            border-left: 4px solid var(--warning-color);
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.8rem;
            font-size: 0.9rem;
        }

        .message-time {
            opacity: 0.85;
            font-size: 0.8rem;
        }

        .message-actions {
            display: flex;
            gap: 0.7rem;
        }

        .message-action {
            background: none;
            border: none;
            color: inherit;
            cursor: pointer;
            font-size: 0.9rem;
            opacity: 0.7;
            transition: opacity 0.2s, transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
        }

        .message-action:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        .message-content {
            line-height: 1.6;
        }

        .message-content p {
            margin-bottom: 0.8rem;
        }

        .message-content a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }

        .message-content a:hover {
            text-decoration: underline;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            padding: 1rem 1.5rem;
            background-color: var(--card-bg);
            border-radius: 16px;
            align-self: flex-start;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px var(--shadow-color);
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background-color: var(--text-color);
            border-radius: 50%;
            opacity: 0.3;
            animation: typing-animation 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing-animation {
            0%, 60%, 100% {
                opacity: 0.3;
                transform: translateY(0);
            }
            30% {
                opacity: 1;
                transform: translateY(-5px);
            }
        }

        .input-container {
            display: flex;
            gap: 0.8rem;
            padding: 1rem 0;
            position: sticky;
            bottom: 0;
            background-color: var(--background-color);
            border-top: 1px solid var(--border-color);
            margin-top: auto;
        }

        .input-wrapper {
            flex: 1;
            position: relative;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .command-dropdown {
            position: absolute;
            bottom: 100%;
            left: 0;
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 5px 15px var(--shadow-color);
            width: 100%;
            max-height: 300px;
            overflow-y: auto;
            z-index: 10;
            display: none;
        }

        .command-dropdown.show {
            display: block;
        }

        .command-item {
            padding: 0.8rem 1.2rem;
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
            transition: background 0.2s;
        }

        .command-item:hover {
            background-color: var(--button-hover);
        }

        .command-item .command-name {
            font-weight: bold;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.3rem;
        }

        .command-item .command-desc {
            font-size: 0.85rem;
            opacity: 0.8;
            padding-left: 1.5rem;
        }

        .input-field {
            flex: 1;
            padding: 0.9rem 1.2rem;
            border: 1px solid var(--border-color);
            border-radius: 30px;
            background-color: var(--input-bg);
            color: var(--text-color);
            font-size: 1rem;
            outline: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .input-field:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(106, 75, 197, 0.2);
        }

        .input-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 50%;
            width: 52px;
            height: 52px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 3px 8px rgba(106, 75, 197, 0.3);
        }

        .input-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(106, 75, 197, 0.4);
        }

        .input-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .voice-btn.listening {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(106, 75, 197, 0.7);
            }
            70% {
                box-shadow: 0 0 0 12px rgba(106, 75, 197, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(106, 75, 197, 0);
            }
        }

        .history-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .history-container.show {
            opacity: 1;
            pointer-events: all;
        }

        .history-content {
            background-color: var(--card-bg);
            border-radius: 16px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .history-header {
            padding: 1.2rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .history-title {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .history-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.8rem;
            cursor: pointer;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .history-close:hover {
            background: rgba(255,255,255,0.2);
        }

        .history-list {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .history-item {
            padding: 0.9rem;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background-color 0.2s;
            border-radius: 8px;
        }

        .history-item:hover {
            background-color: var(--button-hover);
        }

        .history-item-time {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-bottom: 0.3rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .history-item-query {
            font-weight: bold;
            margin-bottom: 0.3rem;
        }

        .history-item-response {
            font-size: 0.9rem;
            opacity: 0.85;
            padding-left: 1rem;
            border-left: 2px solid var(--primary-color);
            margin-top: 0.5rem;
        }

        .history-footer {
            padding: 1rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 0.8rem;
        }

        .history-btn {
            padding: 0.6rem 1.2rem;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .history-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
        }

        .history-clear {
            background-color: var(--error-color);
            color: white;
        }

        .history-export {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .result-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 1.2rem;
            margin-bottom: 1.2rem;
            box-shadow: 0 2px 6px var(--shadow-color);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.8rem;
            padding-bottom: 0.8rem;
            border-bottom: 1px solid var(--border-color);
        }

        .result-title {
            font-weight: bold;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }

        .result-source {
            font-size: 0.85rem;
            opacity: 0.7;
        }

        .result-content {
            line-height: 1.6;
        }

        .result-content p {
            margin-bottom: 0.8rem;
        }

        .error-message {
            color: var(--error-color);
            background-color: rgba(244, 67, 54, 0.1);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid var(--error-color);
        }

        .success-message {
            color: var(--success-color);
            background-color: rgba(76, 175, 80, 0.1);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid var(--success-color);
        }

        .warning-message {
            color: var(--warning-color);
            background-color: rgba(255, 152, 0, 0.1);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid var(--warning-color);
        }

        .info-message {
            color: var(--info-color);
            background-color: rgba(33, 150, 243, 0.1);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid var(--info-color);
        }

        .api-tag {
            display: inline-block;
            padding: 0.2rem 0.6rem;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 4px;
            font-size: 0.75rem;
            margin-left: 0.5rem;
            font-weight: 500;
        }

        .hidden {
            display: none;
        }

        .language-badge {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            background-color: var(--accent-color);
            color: white;
            border-radius: 4px;
            font-size: 0.75rem;
            margin-left: 0.5rem;
        }

        .edit-container {
            background-color: rgba(255, 152, 0, 0.1);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            border-left: 3px solid var(--edit-color);
        }

        .edit-textarea {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--input-bg);
            color: var(--text-color);
            font-size: 1rem;
            min-height: 100px;
            margin-bottom: 0.8rem;
            resize: vertical;
        }

        .edit-actions {
            display: flex;
            gap: 0.8rem;
            justify-content: flex-end;
        }

        .edit-btn {
            padding: 0.5rem 1rem;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
        }

        .edit-save {
            background-color: var(--success-color);
            color: white;
        }

        .edit-cancel {
            background-color: var(--error-color);
            color: white;
        }

        .toast-message {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--card-bg);
            color: var(--text-color);
            padding: 12px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px var(--shadow-color);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .pagination-btn {
            padding: 0.3rem 0.8rem;
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .pagination-btn.active {
            background-color: var(--primary-color);
            color: white;
        }

        .show-more-btn {
            display: block;
            margin-top: 1rem;
            padding: 0.5rem 1rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            text-align: center;
            transition: background-color 0.2s;
        }

        .show-more-btn:hover {
            background-color: var(--secondary-color);
        }

        .language-toggle {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .lang-btn {
            padding: 0.3rem 0.8rem;
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .lang-btn.active {
            background-color: var(--primary-color);
            color: white;
        }

        .calculator {
            background-color: var(--input-bg);
            border-radius: 10px;
            padding: 1rem;
            margin-top: 1rem;
            box-shadow: 0 2px 5px var(--shadow-color);
        }

        .calculator-display {
            width: 100%;
            padding: 0.8rem;
            margin-bottom: 0.8rem;
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1.2rem;
            text-align: right;
        }

        .calculator-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
        }

        .calc-btn {
            padding: 0.8rem;
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: background-color 0.2s;
        }

        .calc-btn:hover {
            background-color: var(--button-hover);
        }

        .calc-btn.operator {
            background-color: rgba(106, 75, 197, 0.1);
        }

        .calc-btn.function {
            background-color: rgba(255, 152, 0, 0.1);
        }

        .calc-btn.equal {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .art-image {
            max-width: 100%;
            border-radius: 8px;
            margin-top: 1rem;
            border: 1px solid var(--border-color);
        }

        @media (max-width: 768px) {
            .message {
                max-width: 90%;
                padding: 1rem;
            }
            
            .header-content {
                flex-direction: column;
                gap: 0.8rem;
            }
            
            .controls {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .input-btn {
                width: 46px;
                height: 46px;
            }
            
            .chat-container {
                max-height: calc(100vh - 180px);
            }
            
            .edit-actions {
                flex-direction: column;
            }
            
            .input-wrapper {
                flex-wrap: wrap;
            }
            
            .calculator-buttons {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
                    </svg>
                </div>
                <span>Anushka.ai</span>
            </div>
            <div class="controls">
                <button class="toggle-btn" id="themeToggle">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 3V4M12 20V21M4 12H3M6.31412 6.31412L5.5 5.5M17.6859 17.6859L18.5 18.5M21 12H20M18.5 5.5L17.6859 6.31412M6.31412 17.6859L5.5 18.5M16 12C16 14.2091 14.2091 16 12 16C9.79086 16 8 14.2091 8 12C8 9.79086 9.79086 8 12 8C14.2091 8 16 9.79086 16 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Theme</span>
                </button>
                <button class="toggle-btn" id="historyToggle">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 8V12L15 15M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>History</span>
                </button>
                <div class="api-toggle">
                    <button class="api-toggle-btn" id="apiToggle">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M10.325 4.317C10.751 3.028 13.249 3.028 13.675 4.317C13.861 4.854 14.432 5.162 14.97 5.05C16.263 4.774 17.574 5.854 17.307 7.151C17.198 7.688 17.591 8.18 18.14 8.18C19.38 8.18 20.25 9.4 19.85 10.6C19.6 11.35 19.95 12.15 20.65 12.45C21.75 12.9 22.1 14.3 21.35 15.15C20.8 15.8 20.8 16.75 21.35 17.4C22.1 18.25 21.75 19.65 20.65 20.1C19.95 20.4 19.6 21.2 19.85 21.95C20.25 23.15 19.38 24.37 18.14 24.37C17.591 24.37 17.198 24.86 17.307 25.4C17.574 26.7 16.263 27.78 14.97 27.5C14.432 27.39 13.861 27.7 13.675 28.23C13.249 29.52 10.751 29.52 10.325 28.23C10.139 27.7 9.568 27.39 9.03 27.5C7.737 27.78 6.426 26.7 6.693 25.4C6.802 24.86 6.409 24.37 5.86 24.37C4.62 24.37 3.75 23.15 4.15 21.95C4.4 21.2 4.05 20.4 3.35 20.1C2.25 19.65 1.9 18.25 2.65 17.4C3.2 16.75 3.2 15.8 2.65 15.15C1.9 14.3 2.25 12.9 3.35 12.45C4.05 12.15 4.4 11.35 4.15 10.6C3.75 9.4 4.62 8.18 5.86 8.18C6.409 8.18 6.802 7.69 6.693 7.15C6.426 5.85 7.737 4.77 9.03 5.05C9.568 5.16 10.139 4.85 10.325 4.317Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>APIs</span>
                    </button>
                    <div class="api-toggle-content" id="apiToggleContent">
                        <div class="api-toggle-item">
                            <input type="checkbox" id="apiWiki" checked>
                            <label for="apiWiki">Wikipedia (@wiki)</label>
                        </div>
                        <div class="api-toggle-item">
                            <input type="checkbox" id="apiDic" checked>
                            <label for="apiDic">Dictionary (@dic)</label>
                        </div>
                        <div class="api-toggle-item">
                            <input type="checkbox" id="apiDuckDuckGo" checked>
                            <label for="apiDuckDuckGo">DuckDuckGo</label>
                        </div>
                        <div class="api-toggle-item">
                            <input type="checkbox" id="apiQuotes" checked>
                            <label for="apiQuotes">Quotes</label>
                        </div>
                        <div class="api-toggle-item">
                            <input type="checkbox" id="apiAdvice" checked>
                            <label for="apiAdvice">Advice</label>
                        </div>
                        <div class="api-toggle-item">
                            <input type="checkbox" id="apiMotivation" checked>
                            <label for="apiMotivation">Motivation</label>
                        </div>
                        <div class="api-toggle-item">
                            <input type="checkbox" id="apiWords" checked>
                            <label for="apiWords">Related Words</label>
                        </div>
                        <div class="api-toggle-item">
                            <input type="checkbox" id="apiRecipes" checked>
                            <label for="apiRecipes">Recipes</label>
                        </div>
                        <div class="api-toggle-item">
                            <input type="checkbox" id="apiNumbers" checked>
                            <label for="apiNumbers">Number Facts</label>
                        </div>
                        <div class="api-toggle-item">
                            <input type="checkbox" id="apiProgramming" checked>
                            <label for="apiProgramming">Programming Quotes</label>
                        </div>
                        <div class="toggle-all">
                            <button id="enableAll">Enable All</button>
                            <button id="disableAll">Disable All</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main>
        <div class="chat-container" id="chatContainer">
            <!-- Messages will appear here -->
        </div>

        <div class="input-container">
            <div class="input-wrapper">
                <div class="command-dropdown" id="commandDropdown">
                    <div class="command-item" data-command="@wiki">
                        <div class="command-name">@wiki</div>
                        <div class="command-desc">Search Wikipedia (e.g., "@wiki Apple" or "@wiki सेब in hindi")</div>
                    </div>
                    <div class="command-item" data-command="@dic">
                        <div class="command-name">@dic</div>
                        <div class="command-desc">Dictionary definition (e.g., "@dic hello")</div>
                    </div>
                    <div class="command-item" data-command="@text">
                        <div class="command-name">@text</div>
                        <div class="command-desc">Previous answer in text format</div>
                    </div>
                    <div class="command-item" data-command="@search">
                        <div class="command-name">@search</div>
                        <div class="command-desc">Web search (e.g., "@search latest news")</div>
                    </div>
                    <div class="command-item" data-command="@translate">
                        <div class="command-name">@translate</div>
                        <div class="command-desc">Translate text (e.g., "@translate Hello to Hindi")</div>
                    </div>
                    <div class="command-item" data-command="@weather">
                        <div class="command-name">@weather</div>
                        <div class="command-desc">Get weather (e.g., "@weather London")</div>
                    </div>
                    <div class="command-item" data-command="@qr">
                        <div class="command-name">@qr</div>
                        <div class="command-desc">Generate QR code (e.g., "@qr https://example.com")</div>
                    </div>
                    <div class="command-item" data-command="@bill">
                        <div class="command-name">@bill</div>
                        <div class="command-desc">Generate an invoice PDF</div>
                    </div>
                    <div class="command-item" data-command="@ask">
                        <div class="command-name">@ask</div>
                        <div class="command-desc">Create a Q&A knowledge base</div>
                    </div>
                    <div class="command-item" data-command="@image">
                        <div class="command-name">@image</div>
                        <div class="command-desc">Edit images with advanced tools</div>
                    </div>
                    <div class="command-item" data-command="@math">
                        <div class="command-name">@math</div>
                        <div class="command-desc">Solve math equations and show calculator</div>
                    </div>
                    <div class="command-item" data-command="@art">
                        <div class="command-name">@art</div>
                        <div class="command-desc">Generate AI art from text prompt</div>
                    </div>
                    <div class="command-item" data-command="@help">
                        <div class="command-name">@help</div>
                        <div class="command-desc">Show all available commands</div>
                    </div>
                </div>
                <textarea class="input-field" id="userInput" placeholder="Ask me anything or type @ for commands..." rows="1" autocomplete="off"></textarea>
                <button class="input-btn" id="sendBtn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M22 2L11 13M22 2L15 22L11 13M11 13L2 9L22 2Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
            <button class="input-btn voice-btn" id="voiceBtn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2C10.3431 2 9 3.34315 9 5V11C9 12.6569 10.3431 14 12 14C13.6569 14 15 12.6569 15 11V5C15 3.34315 13.6569 2 12 2Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M19 10V11C19 14.866 15.866 18 12 18C8.13401 18 5 14.866 5 11V10" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12 18V22M8 22H16" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>
    </main>

    <div class="history-container" id="historyContainer">
        <div class="history-content">
            <div class="history-header">
                <div class="history-title">Chat History</div>
                <button class="history-close" id="historyClose">&times;</button>
            </div>
            <div class="history-list" id="historyList">
                <!-- History items will appear here -->
            </div>
            <div class="history-footer">
                <button class="history-btn history-clear" id="clearHistory">Clear</button>
                <button class="history-btn history-export" id="exportHistory">Export</button>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const chatContainer = document.getElementById('chatContainer');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const voiceBtn = document.getElementById('voiceBtn');
        const themeToggle = document.getElementById('themeToggle');
        const historyToggle = document.getElementById('historyToggle');
        const historyContainer = document.getElementById('historyContainer');
        const historyClose = document.getElementById('historyClose');
        const historyList = document.getElementById('historyList');
        const clearHistory = document.getElementById('clearHistory');
        const exportHistory = document.getElementById('exportHistory');
        const commandDropdown = document.getElementById('commandDropdown');
        const apiToggle = document.getElementById('apiToggle');
        const apiToggleContent = document.getElementById('apiToggleContent');
        const enableAll = document.getElementById('enableAll');
        const disableAll = document.getElementById('disableAll');

        // API checkboxes
        const apiCheckboxes = {
            wiki: document.getElementById('apiWiki'),
            dic: document.getElementById('apiDic'),
            duckDuckGo: document.getElementById('apiDuckDuckGo'),
            quotes: document.getElementById('apiQuotes'),
            advice: document.getElementById('apiAdvice'),
            motivation: document.getElementById('apiMotivation'),
            words: document.getElementById('apiWords'),
            recipes: document.getElementById('apiRecipes'),
            numbers: document.getElementById('apiNumbers'),
            programming: document.getElementById('apiProgramming')
        };

        // State variables
        let isListening = false;
        let recognition;
        let conversationHistory = [];
        let lastResponse = null;
        let editingMessageId = null;
        let qaKnowledgeBase = [];
        let currentImage = null;
        let imageEditorActive = false;
        let cropper = null;
        let currentPage = 1;
        let totalPages = 1;
        let currentContent = '';
        let isHindi = false;

        // Initialize the app
        function init() {
            loadTheme();
            loadHistory();
            loadApiSettings();
            loadQA();
            setupEventListeners();
            addWelcomeMessage();
            setupTextareaResizing();
        }

        // Set up textarea auto-resizing
        function setupTextareaResizing() {
            userInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
                
                if (this.scrollHeight > 150) {
                    this.style.overflowY = 'auto';
                    this.style.height = '150px';
                } else {
                    this.style.overflowY = 'hidden';
                }
            });
        }

        // Set up event listeners
        function setupEventListeners() {
            sendBtn.addEventListener('click', sendMessage);
            userInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            voiceBtn.addEventListener('click', toggleVoiceInput);
            themeToggle.addEventListener('click', toggleTheme);
            historyToggle.addEventListener('click', () => historyContainer.classList.add('show'));
            historyClose.addEventListener('click', () => historyContainer.classList.remove('show'));
            clearHistory.addEventListener('click', clearChatHistory);
            exportHistory.addEventListener('click', exportChatHistory);

            userInput.addEventListener('focus', () => {
                if (userInput.value === '@') commandDropdown.classList.add('show');
            });
            userInput.addEventListener('blur', () => {
                setTimeout(() => commandDropdown.classList.remove('show'), 200);
            });
            userInput.addEventListener('input', (e) => {
                if (e.target.value === '@') commandDropdown.classList.add('show');
                else if (!e.target.value.startsWith('@')) commandDropdown.classList.remove('show');
            });

            document.querySelectorAll('.command-item').forEach(item => {
                item.addEventListener('click', () => {
                    const command = item.getAttribute('data-command');
                    userInput.value = command + ' ';
                    userInput.focus();
                    commandDropdown.classList.remove('show');
                });
            });

            apiToggle.addEventListener('click', () => apiToggleContent.classList.toggle('show'));
            enableAll.addEventListener('click', () => {
                Object.values(apiCheckboxes).forEach(checkbox => checkbox.checked = true);
                saveApiSettings();
            });
            disableAll.addEventListener('click', () => {
                Object.values(apiCheckboxes).forEach(checkbox => checkbox.checked = false);
                saveApiSettings();
            });

            Object.values(apiCheckboxes).forEach(checkbox => {
                checkbox.addEventListener('change', saveApiSettings);
            });

            document.addEventListener('click', (e) => {
                if (!apiToggle.contains(e.target) && !apiToggleContent.contains(e.target)) {
                    apiToggleContent.classList.remove('show');
                }
            });
        }

        // Add welcome message
        function addWelcomeMessage() {
            const welcomeMessage = `
                <div class="message bot-message">
                    <div class="message-header">
                        <span>Anushka.ai</span>
                        <span class="message-time">${formatTime(new Date())}</span>
                    </div>
                    <div class="message-content">
                        <p>Hello! I'm Anushka.ai, your multilingual AI assistant with advanced features.</p>
                        <p>Try these powerful commands:</p>
                        <ul>
                            <li><strong>@math</strong> - Solve equations and use calculator</li>
                            <li><strong>@art</strong> - Generate AI art from text</li>
                            <li><strong>@bill</strong> - Generate professional invoices</li>
                            <li><strong>@help</strong> - Show all available commands</li>
                        </ul>
                        <p>Type @ to see all available commands.</p>
                    </div>
                </div>
            `;
            chatContainer.insertAdjacentHTML('beforeend', welcomeMessage);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Send message function
        function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;

            // Detect language
            isHindi = isHindiText(message);
            
            // Add user message to chat
            addMessageToChat(message, 'user');

            // Clear input and reset height
            userInput.value = '';
            userInput.style.height = 'auto';

            // Show typing indicator
            showTypingIndicator();

            // Process message
            setTimeout(() => processUserMessage(message), 500);
        }

        // Add message to chat
        function addMessageToChat(message, sender, isHtml = false) {
            const messageDiv = document.createElement('div');
            const messageId = Date.now() + '-' + Math.random().toString(36).substr(2, 9);
            messageDiv.dataset.messageId = messageId;
            
            let messageClass = `message ${sender}-message`;
            
            if (sender === 'bot' && (message.includes('@bill') || message.includes('@ask') || message.includes('@image'))) {
                messageClass += ' feature-message';
            }
            
            messageDiv.className = messageClass;
            
            const messageHeader = document.createElement('div');
            messageHeader.className = 'message-header';
            
            const senderSpan = document.createElement('span');
            senderSpan.textContent = sender === 'user' ? 'You' : 'Anushka.ai';
            
            const timeSpan = document.createElement('span');
            timeSpan.className = 'message-time';
            timeSpan.textContent = formatTime(new Date());
            
            messageHeader.appendChild(senderSpan);
            messageHeader.appendChild(timeSpan);
            
            const actionsDiv = document.createElement('div');
            actionsDiv.className = 'message-actions';
            
            const copyBtn = document.createElement('button');
            copyBtn.className = 'message-action';
            copyBtn.title = 'Copy';
            copyBtn.innerHTML = `
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 4H4C3.44772 4 3 4.44772 3 5V19C3 19.5523 3.44772 20 4 20H18C18.5523 20 19 19.5523 19 19V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M8 8H20C20.5523 8 21 8.44772 21 9V20C21 20.5523 20.5523 21 20 21H9C8.44772 21 8 20.5523 8 20V8Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            `;
            copyBtn.addEventListener('click', () => {
                copyToClipboard(isHtml ? message : message.textContent || message.innerText);
                showToast('Copied to clipboard!');
            });
            
            const shareBtn = document.createElement('button');
            shareBtn.className = 'message-action';
            shareBtn.title = 'Share';
            shareBtn.innerHTML = `
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18 8C19.6569 8 21 6.65685 21 5C21 3.34315 19.6569 2 18 2C16.3431 2 15 3.34315 15 5C15 6.65685 16.3431 8 18 8Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M6 15C7.65685 15 9 13.6569 9 12C9 10.3431 7.65685 9 6 9C4.34315 9 3 10.3431 3 12C3 13.6569 4.34315 15 6 15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M18 22C19.6569 22 21 20.6569 21 19C21 17.3431 19.6569 16 18 16C16.3431 16 15 17.3431 15 19C15 20.6569 16.3431 22 18 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M8.58984 13.5098L15.4198 17.4898" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M15.4098 6.50977L8.58984 10.4898" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            `;
            shareBtn.addEventListener('click', () => shareMessage(isHtml ? message : message.textContent || message.innerText));
            
            const ttsBtn = document.createElement('button');
            ttsBtn.className = 'message-action';
            ttsBtn.title = 'Read aloud';
            ttsBtn.innerHTML = `
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 6V18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M9 9V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M18 11V13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M6 11V13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M15 7V17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M3 14V10C3 9.44772 3.44772 9 4 9H5.58579C5.851 9 6.10536 8.89464 6.29289 8.70711L9.87868 5.12132C10.4413 4.55871 11 4.19891 11 5C11 5.55228 11.4477 6 12 6C12.5523 6 13 5.55228 13 5C13 4.19891 13.5587 4.55871 14.1213 5.12132L17.7071 8.70711C17.8946 8.89464 18.149 9 18.4142 9H20C20.5523 9 21 9.44772 21 10V14C21 14.5523 20.5523 15 20 15H18.4142C18.149 15 17.8946 15.1054 17.7071 15.2929L14.1213 18.8787C13.5587 19.4413 13 19.8011 13 19C13 18.4477 12.5523 18 12 18C11.4477 18 11 18.4477 11 19C11 19.8011 10.4413 19.4413 9.87868 18.8787L6.29289 15.2929C6.10536 15.1054 5.851 15 5.58579 15H4C3.44772 15 3 14.5523 3 14Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            `;
            ttsBtn.addEventListener('click', () => readAloud(isHtml ? message.textContent || message.innerText : message));
            
            const editBtn = document.createElement('button');
            editBtn.className = 'message-action';
            editBtn.title = 'Edit';
            editBtn.innerHTML = `
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M18.5 2.5C18.8978 2.10217 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10217 21.5 2.5C21.8978 2.89782 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10217 21.5 5.5L12 15L8 16L9 12L18.5 2.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            `;
            editBtn.addEventListener('click', () => startEditingMessage(messageDiv, messageId, sender));
            
            actionsDiv.appendChild(copyBtn);
            actionsDiv.appendChild(shareBtn);
            actionsDiv.appendChild(ttsBtn);
            actionsDiv.appendChild(editBtn);
            messageHeader.appendChild(actionsDiv);
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            
            if (isHtml) {
                messageContent.innerHTML = message;
            } else {
                const paragraphs = message.split('\n\n');
                paragraphs.forEach(para => {
                    const p = document.createElement('p');
                    p.textContent = para;
                    messageContent.appendChild(p);
                });
            }
            
            messageDiv.appendChild(messageHeader);
            messageDiv.appendChild(messageContent);
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            saveToHistory(message, sender, messageId, isHtml);
        }

        // Process user message
        async function processUserMessage(message) {
            try {
                hideTypingIndicator();

                if (message.startsWith('@math ')) {
                    const expression = message.substring(6).trim();
                    await solveMathExpression(expression);
                } else if (message.startsWith('@art ')) {
                    const prompt = message.substring(5).trim();
                    generateArt(prompt);
                } else if (message.startsWith('@wiki ')) {
                    if (!apiCheckboxes.wiki.checked) {
                        addMessageToChat('Wikipedia search is currently disabled. Enable it in API settings.', 'bot');
                        return;
                    }
                    const query = message.substring(6).trim();
                    await searchWikipedia(query);
                } else if (message.startsWith('@dic ')) {
                    if (!apiCheckboxes.dic.checked) {
                        addMessageToChat('Dictionary search is currently disabled. Enable it in API settings.', 'bot');
                        return;
                    }
                    const word = message.substring(5).trim();
                    await searchDictionary(word);
                } else if (message === '@text' || message.startsWith('@text ')) {
                    if (lastResponse) {
                        addMessageToChat(lastResponse, 'bot');
                    } else {
                        addMessageToChat('No previous response available.', 'bot');
                    }
                } else if (message.startsWith('@search ')) {
                    const query = message.substring(8).trim();
                    await searchWeb(query);
                } else if (message.startsWith('@translate ')) {
                    const text = message.substring(11).trim();
                    await translateText(text);
                } else if (message.startsWith('@weather ')) {
                    const location = message.substring(9).trim();
                    await getWeather(location);
                } else if (message.startsWith('@qr ')) {
                    const text = message.substring(4).trim();
                    generateQRCode(text);
                } else if (message === '@help' || message.startsWith('@help ')) {
                    showHelp();
                } else {
                    const response = `I've processed your query: "${message}". For more specific responses, try using commands like @wiki, @dic, or @search.`;
                    addMessageToChat(response, 'bot');
                }
            } catch (error) {
                console.error('Error processing message:', error);
                addMessageToChat('Sorry, I encountered an error processing your request. Please try again.', 'bot');
                hideTypingIndicator();
            }
        }

        // Detect Hindi text
        function isHindiText(text) {
            const hindiPattern = /[\u0900-\u097F]/;
            return hindiPattern.test(text);
        }

        // Solve math expression
        async function solveMathExpression(expression) {
            try {
                // First try MathJS API
                const mathJSResult = await fetch(`https://api.mathjs.org/v4/?expr=${encodeURIComponent(expression)}`);
                if (mathJSResult.ok) {
                    const result = await mathJSResult.text();
                    const translatedResult = isHindi ? await translateToHindi(result) : result;
                    
                    const responseHtml = `
                        <div class="result-card">
                            <div class="result-header">
                                <div class="result-title">Math Solution</div>
                            </div>
                            <div class="result-content">
                                <p><strong>Expression:</strong> ${expression}</p>
                                <p><strong>Result:</strong> ${result}</p>
                                ${isHindi ? `<p><strong>हिंदी में:</strong> ${translatedResult}</p>` : ''}
                            </div>
                        </div>
                        <div class="calculator">
                            <input type="text" class="calculator-display" id="calcDisplay" readonly>
                            <div class="calculator-buttons" id="calcButtons">
                                <button class="calc-btn" data-value="7">7</button>
                                <button class="calc-btn" data-value="8">8</button>
                                <button class="calc-btn" data-value="9">9</button>
                                <button class="calc-btn operator" data-value="/">/</button>
                                
                                <button class="calc-btn" data-value="4">4</button>
                                <button class="calc-btn" data-value="5">5</button>
                                <button class="calc-btn" data-value="6">6</button>
                                <button class="calc-btn operator" data-value="*">×</button>
                                
                                <button class="calc-btn" data-value="1">1</button>
                                <button class="calc-btn" data-value="2">2</button>
                                <button class="calc-btn" data-value="3">3</button>
                                <button class="calc-btn operator" data-value="-">-</button>
                                
                                <button class="calc-btn" data-value="0">0</button>
                                <button class="calc-btn" data-value=".">.</button>
                                <button class="calc-btn equal" data-value="=">=</button>
                                <button class="calc-btn operator" data-value="+">+</button>
                                
                                <button class="calc-btn function" data-value="sin">sin</button>
                                <button class="calc-btn function" data-value="cos">cos</button>
                                <button class="calc-btn function" data-value="tan">tan</button>
                                <button class="calc-btn function" data-value="sqrt">√</button>
                                
                                <button class="calc-btn function" data-value="(">(</button>
                                <button class="calc-btn function" data-value=")">)</button>
                                <button class="calc-btn function" data-value="^">^</button>
                                <button class="calc-btn function" data-value="C">C</button>
                            </div>
                        </div>
                    `;
                    
                    lastResponse = responseHtml;
                    addMessageToChat(responseHtml, 'bot', true);
                    
                    // Add calculator event listeners
                    setTimeout(() => setupCalculator(), 100);
                    return;
                }
                
                // Fallback to Newton API
                const newtonResult = await fetch(`https://newton.vercel.app/api/v2/solve/${encodeURIComponent(expression)}`);
                if (newtonResult.ok) {
                    const data = await newtonResult.json();
                    const result = data.result;
                    const translatedResult = isHindi ? await translateToHindi(result) : result;
                    
                    const responseHtml = `
                        <div class="result-card">
                            <div class="result-header">
                                <div class="result-title">Math Solution</div>
                            </div>
                            <div class="result-content">
                                <p><strong>Expression:</strong> ${expression}</p>
                                <p><strong>Result:</strong> ${result}</p>
                                ${isHindi ? `<p><strong>हिंदी में:</strong> ${translatedResult}</p>` : ''}
                            </div>
                        </div>
                        <div class="calculator">
                            <input type="text" class="calculator-display" id="calcDisplay" readonly>
                            <div class="calculator-buttons" id="calcButtons">
                                <button class="calc-btn" data-value="7">7</button>
                                <button class="calc-btn" data-value="8">8</button>
                                <button class="calc-btn" data-value="9">9</button>
                                <button class="calc-btn operator" data-value="/">/</button>
                                
                                <button class="calc-btn" data-value="4">4</button>
                                <button class="calc-btn" data-value="5">5</button>
                                <button class="calc-btn" data-value="6">6</button>
                                <button class="calc-btn operator" data-value="*">×</button>
                                
                                <button class="calc-btn" data-value="1">1</button>
                                <button class="calc-btn" data-value="2">2</button>
                                <button class="calc-btn" data-value="3">3</button>
                                <button class="calc-btn operator" data-value="-">-</button>
                                
                                <button class="calc-btn" data-value="0">0</button>
                                <button class="calc-btn" data-value=".">.</button>
                                <button class="calc-btn equal" data-value="=">=</button>
                                <button class="calc-btn operator" data-value="+">+</button>
                                
                                <button class="calc-btn function" data-value="sin">sin</button>
                                <button class="calc-btn function" data-value="cos">cos</button>
                                <button class="calc-btn function" data-value="tan">tan</button>
                                <button class="calc-btn function" data-value="sqrt">√</button>
                                
                                <button class="calc-btn function" data-value="(">(</button>
                                <button class="calc-btn function" data-value=")">)</button>
                                <button class="calc-btn function" data-value="^">^</button>
                                <button class="calc-btn function" data-value="C">C</button>
                            </div>
                        </div>
                    `;
                    
                    lastResponse = responseHtml;
                    addMessageToChat(responseHtml, 'bot', true);
                    
                    // Add calculator event listeners
                    setTimeout(() => setupCalculator(), 100);
                    return;
                }
                
                // If both APIs fail
                addMessageToChat(`Sorry, I couldn't solve the expression: ${expression}`, 'bot');
            } catch (error) {
                console.error('Math solving error:', error);
                addMessageToChat(`Sorry, I couldn't solve the expression: ${expression}`, 'bot');
            }
        }

        // Setup calculator
        function setupCalculator() {
            const display = document.getElementById('calcDisplay');
            const buttons = document.querySelectorAll('.calc-btn');
            
            buttons.forEach(button => {
                button.addEventListener('click', () => {
                    const value = button.getAttribute('data-value');
                    
                    if (value === '=') {
                        try {
                            display.value = eval(display.value);
                        } catch (error) {
                            display.value = 'Error';
                        }
                    } else if (value === 'C') {
                        display.value = '';
                    } else if (value === 'sqrt') {
                        display.value += 'Math.sqrt(';
                    } else if (value === 'sin') {
                        display.value += 'Math.sin(';
                    } else if (value === 'cos') {
                        display.value += 'Math.cos(';
                    } else if (value === 'tan') {
                        display.value += 'Math.tan(';
                    } else if (value === '^') {
                        display.value += '**';
                    } else {
                        display.value += value;
                    }
                });
            });
        }

        // Generate AI art
        function generateArt(prompt) {
            const urlPrompt = encodeURIComponent(prompt);
            const imageUrl = `https://image.pollinations.ai/prompt/${urlPrompt}`;
            
            const responseHtml = `
                <div class="result-card">
                    <div class="result-header">
                        <div class="result-title">AI Art: ${prompt}</div>
                    </div>
                    <div class="result-content">
                        <p>Generated from prompt: "${prompt}"</p>
                        <img src="${imageUrl}" alt="${prompt}" class="art-image">
                    </div>
                </div>
            `;
            
            lastResponse = responseHtml;
            addMessageToChat(responseHtml, 'bot', true);
        }

        // Search Wikipedia
        async function searchWikipedia(query) {
            // Detect if user wants results in Hindi
            const inHindi = query.toLowerCase().endsWith('in hindi');
            const lang = inHindi ? 'hi' : 'en';
            const cleanQuery = inHindi ? query.substring(0, query.length - 8).trim() : query;

            try {
                // First try DuckDuckGo API
                const ddgResponse = await fetch(`https://api.duckduckgo.com/?q=${encodeURIComponent(cleanQuery)}&format=json&no_html=1`);
                const ddgData = await ddgResponse.json();
                
                if (ddgData.AbstractText) {
                    let extract = ddgData.AbstractText;
                    
                    // If extract is too long, truncate it
                    if (extract.length > 1500) {
                        extract = extract.substring(0, 1500) + '...';
                    }
                    
                    // Format the response
                    const formattedResponse = `
                        <div class="result-card">
                            <div class="result-header">
                                <div class="result-title">${ddgData.Heading || cleanQuery}</div>
                            </div>
                            <div class="result-content">
                                ${extract.split('\n').map(para => `<p>${para}</p>`).join('')}
                            </div>
                        </div>
                    `;
                    
                    lastResponse = extract;
                    addMessageToChat(formattedResponse, 'bot', true);
                    return;
                }
                
                // Fallback to Wikipedia API
                const wikiResponse = await fetch(`https://${lang}.wikipedia.org/w/api.php?action=query&format=json&origin=*&prop=extracts&titles=${encodeURIComponent(cleanQuery)}&explaintext=true`);
                const wikiData = await wikiResponse.json();
                
                const pages = wikiData.query.pages;
                const pageId = Object.keys(pages)[0];
                const page = pages[pageId];
                
                if (page.missing === '') {
                    addMessageToChat(`I couldn't find information about "${cleanQuery}".`, 'bot');
                    return;
                }
                
                let extract = page.extract;
                
                // If extract is too long, truncate it
                if (extract.length > 1500) {
                    extract = extract.substring(0, 1500) + '...';
                }
                
                // Format the response
                const formattedResponse = `
                    <div class="result-card">
                        <div class="result-header">
                            <div class="result-title">${page.title}</div>
                        </div>
                        <div class="result-content">
                            ${extract.split('\n').map(para => `<p>${para}</p>`).join('')}
                            <p><a href="https://${lang}.wikipedia.org/wiki/${encodeURIComponent(page.title)}" target="_blank">Read more</a></p>
                        </div>
                    </div>
                `;
                
                lastResponse = extract;
                addMessageToChat(formattedResponse, 'bot', true);
            } catch (error) {
                console.error('Wikipedia search error:', error);
                addMessageToChat(`Sorry, I couldn't fetch results for "${cleanQuery}".`, 'bot');
            }
        }

        // Search Dictionary
        async function searchDictionary(word) {
            try {
                const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${encodeURIComponent(word)}`);
                
                if (!response.ok) {
                    throw new Error('Word not found');
                }
                
                const data = await response.json();
                const entry = data[0];
                
                let responseHtml = `
                    <div class="result-card">
                        <div class="result-header">
                            <div class="result-title">Dictionary: ${entry.word}</div>
                        </div>
                        <div class="result-content">
                `;
                
                // Phonetics
                if (entry.phonetics && entry.phonetics.length > 0) {
                    const phonetic = entry.phonetics.find(p => p.text) || entry.phonetics[0];
                    responseHtml += `<p><strong>Pronunciation:</strong> ${phonetic.text}</p>`;
                    if (phonetic.audio) {
                        responseHtml += `<audio controls src="${phonetic.audio}" style="width: 100%; margin-top: 0.5rem;"></audio>`;
                    }
                }
                
                // Meanings
                entry.meanings.forEach(meaning => {
                    responseHtml += `<h3>${meaning.partOfSpeech}</h3>`;
                    
                    meaning.definitions.forEach((def, idx) => {
                        responseHtml += `<p><strong>${idx + 1}.</strong> ${def.definition}</p>`;
                        if (def.example) {
                            responseHtml += `<p><em>Example:</em> ${def.example}</p>`;
                        }
                        if (def.synonyms && def.synonyms.length > 0) {
                            responseHtml += `<p><em>Synonyms:</em> ${def.synonyms.join(', ')}</p>`;
                        }
                        if (def.antonyms && def.antonyms.length > 0) {
                            responseHtml += `<p><em>Antonyms:</em> ${def.antonyms.join(', ')}</p>`;
                        }
                    });
                });
                
                responseHtml += `
                        </div>
                    </div>
                `;
                
                lastResponse = responseHtml;
                addMessageToChat(responseHtml, 'bot', true);
            } catch (error) {
                console.error('Dictionary search error:', error);
                addMessageToChat(`Sorry, I couldn't find the definition for "${word}".`, 'bot');
            }
        }

        // Search web using DuckDuckGo
        async function searchWeb(query) {
            if (!apiCheckboxes.duckDuckGo.checked) {
                addMessageToChat('Web search is currently disabled. Enable it in API settings.', 'bot');
                return;
            }

            try {
                const response = await fetch(`https://api.duckduckgo.com/?q=${encodeURIComponent(query)}&format=json`);
                const data = await response.json();
                
                if (!data.Results || data.Results.length === 0) {
                    addMessageToChat(`I couldn't find any results for "${query}".`, 'bot');
                    return;
                }
                
                let responseHtml = `
                    <div class="result-card">
                        <div class="result-header">
                            <div class="result-title">Search Results: ${query}</div>
                        </div>
                        <div class="result-content">
                            <p>Top results:</p>
                            <ul>
                `;
                
                data.Results.slice(0, 5).forEach(result => {
                    responseHtml += `<li><a href="${result.FirstURL}" target="_blank">${result.Text}</a></li>`;
                });
                
                responseHtml += `
                            </ul>
                        </div>
                    </div>
                `;
                
                lastResponse = responseHtml;
                addMessageToChat(responseHtml, 'bot', true);
            } catch (error) {
                console.error('Web search error:', error);
                addMessageToChat(`Sorry, I couldn't perform the web search for "${query}".`, 'bot');
            }
        }

        // Translate text
        async function translateText(text) {
            try {
                // Parse the text to translate and target language
                const toIndex = text.toLowerCase().indexOf(' to ');
                if (toIndex === -1) {
                    addMessageToChat('Please specify the target language with "to". Example: "@translate Hello to Hindi"', 'bot');
                    return;
                }
                
                const textToTranslate = text.substring(0, toIndex).trim();
                const targetLang = text.substring(toIndex + 4).trim().toLowerCase();
                
                // Map common language names to language codes
                const langMap = {
                    'hindi': 'hi',
                    'english': 'en',
                    'spanish': 'es',
                    'french': 'fr',
                    'german': 'de',
                    'italian': 'it',
                    'portuguese': 'pt',
                    'russian': 'ru',
                    'chinese': 'zh',
                    'japanese': 'ja',
                    'korean': 'ko',
                    'arabic': 'ar',
                    'bengali': 'bn',
                    'tamil': 'ta',
                    'telugu': 'te',
                    'marathi': 'mr',
                    'gujarati': 'gu',
                    'kannada': 'kn',
                    'malayalam': 'ml',
                    'punjabi': 'pa',
                    'urdu': 'ur'
                };
                
                const langCode = langMap[targetLang] || targetLang;
                
                const translatedText = await translateToHindi(textToTranslate, langCode);
                
                const responseHtml = `
                    <div class="result-card">
                        <div class="result-header">
                            <div class="result-title">Translation</div>
                        </div>
                        <div class="result-content">
                            <p><strong>Original:</strong> ${textToTranslate}</p>
                            <p><strong>Translation (${targetLang}):</strong> ${translatedText}</p>
                            <div class="language-toggle">
                                <button class="lang-btn" id="langEn">English</button>
                                <button class="lang-btn" id="langHi">Hindi</button>
                                <button class="lang-btn" id="langEs">Spanish</button>
                                <button class="lang-btn" id="langFr">French</button>
                            </div>
                        </div>
                    </div>
                `;
                
                lastResponse = translatedText;
                addMessageToChat(responseHtml, 'bot', true);
                
                // Add language toggle listeners
                setTimeout(() => {
                    document.getElementById('langEn').addEventListener('click', () => translateText(`${textToTranslate} to english`));
                    document.getElementById('langHi').addEventListener('click', () => translateText(`${textToTranslate} to hindi`));
                    document.getElementById('langEs').addEventListener('click', () => translateText(`${textToTranslate} to spanish`));
                    document.getElementById('langFr').addEventListener('click', () => translateText(`${textToTranslate} to french`));
                }, 100);
            } catch (error) {
                console.error('Translation error:', error);
                addMessageToChat(`Sorry, I couldn't translate that text.`, 'bot');
            }
        }

        // Translate text to target language
        async function translateToHindi(text, targetLang = 'hi') {
            try {
                const response = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${targetLang}&dt=t&q=${encodeURIComponent(text)}`);
                const data = await response.json();
                return data[0].map(item => item[0]).join('');
            } catch (error) {
                console.error('Translation error:', error);
                return text; // Return original text if translation fails
            }
        }

        // Get weather
        async function getWeather(location) {
            try {
                const response = await fetch(`https://api.weatherapi.com/v1/current.json?key=demo&q=${encodeURIComponent(location)}`);
                const data = await response.json();
                
                const weatherData = {
                    location: data.location.name,
                    country: data.location.country,
                    temp: data.current.temp_c,
                    condition: data.current.condition.text,
                    humidity: data.current.humidity,
                    wind: data.current.wind_kph
                };
                
                const responseHtml = `
                    <div class="result-card">
                        <div class="result-header">
                            <div class="result-title">Weather in ${weatherData.location}, ${weatherData.country}</div>
                        </div>
                        <div class="result-content">
                            <p><strong>Condition:</strong> ${weatherData.condition}</p>
                            <p><strong>Temperature:</strong> ${weatherData.temp}°C</p>
                            <p><strong>Humidity:</strong> ${weatherData.humidity}%</p>
                            <p><strong>Wind:</strong> ${weatherData.wind} km/h</p>
                        </div>
                    </div>
                `;
                
                lastResponse = responseHtml;
                addMessageToChat(responseHtml, 'bot', true);
            } catch (error) {
                console.error('Weather error:', error);
                addMessageToChat(`Sorry, I couldn't fetch the weather for "${location}".`, 'bot');
            }
        }

        // Generate QR code
        function generateQRCode(text) {
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(text)}`;
            
            const responseHtml = `
                <div class="result-card">
                    <div class="result-header">
                        <div class="result-title">QR Code</div>
                    </div>
                    <div class="result-content">
                        <p>QR Code for: "${text}"</p>
                        <img src="${qrUrl}" alt="QR Code" style="max-width: 150px; height: auto;">
                        <p><a href="${qrUrl}" download="qrcode.png">Download QR Code</a></p>
                    </div>
                </div>
            `;
            
            lastResponse = responseHtml;
            addMessageToChat(responseHtml, 'bot', true);
        }

        // Show help
        function showHelp() {
            const helpMessage = `
                <div class="result-card">
                    <div class="result-header">
                        <div class="result-title">Available Commands</div>
                    </div>
                    <div class="result-content">
                        <p>Here are all the commands you can use with Anushka.ai:</p>
                        
                        <h3>Information Features</h3>
                        <ul>
                            <li><strong>@wiki [topic]</strong> - Search Wikipedia</li>
                            <li><strong>@dic [word]</strong> - Dictionary definition</li>
                            <li><strong>@search [query]</strong> - Web search</li>
                            <li><strong>@translate [text] to [language]</strong> - Translate text</li>
                            <li><strong>@weather [location]</strong> - Get weather forecast</li>
                            <li><strong>@qr [text]</strong> - Generate QR code</li>
                        </ul>
                        
                        <h3>Tools</h3>
                        <ul>
                            <li><strong>@math [expression]</strong> - Solve math equations and show calculator</li>
                            <li><strong>@art [prompt]</strong> - Generate AI art from text prompt</li>
                            <li><strong>@bill</strong> - Generate professional invoices</li>
                            <li><strong>@ask</strong> - Create your own Q&A knowledge base</li>
                            <li><strong>@image</strong> - Edit images with advanced tools</li>
                        </ul>
                        
                        <h3>Utility Commands</h3>
                        <ul>
                            <li><strong>@text</strong> - Show previous answer in text format</li>
                            <li><strong>@help</strong> - Show this help message</li>
                        </ul>
                    </div>
                </div>
            `;
            
            addMessageToChat(helpMessage, 'bot', true);
        }

        // Toggle voice input
        function toggleVoiceInput() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                addMessageToChat('Your browser does not support speech recognition. Try Chrome or Edge.', 'bot');
                return;
            }
            
            if (isListening) {
                stopVoiceInput();
                return;
            }
            
            startVoiceInput();
        }

        // Start voice input
        function startVoiceInput() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            
            recognition.onstart = () => {
                isListening = true;
                voiceBtn.classList.add('listening');
                addMessageToChat('Listening... Speak now.', 'bot');
            };
            
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                userInput.value = transcript;
                voiceBtn.classList.remove('listening');
                isListening = false;
                sendMessage();
            };
            
            recognition.onerror = (event) => {
                console.error('Speech recognition error', event.error);
                voiceBtn.classList.remove('listening');
                isListening = false;
                addMessageToChat(`Speech recognition error: ${event.error}`, 'bot');
            };
            
            recognition.onend = () => {
                if (isListening) {
                    setTimeout(() => recognition.start(), 100);
                } else {
                    voiceBtn.classList.remove('listening');
                }
            };
            
            recognition.start();
        }

        // Stop voice input
        function stopVoiceInput() {
            if (recognition) recognition.stop();
            isListening = false;
            voiceBtn.classList.remove('listening');
        }

        // Show typing indicator
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'typing-indicator';
            typingDiv.id = 'typingIndicator';
            
            for (let i = 0; i < 3; i++) {
                const dot = document.createElement('div');
                dot.className = 'typing-dot';
                typingDiv.appendChild(dot);
            }
            
            chatContainer.appendChild(typingDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Hide typing indicator
        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) typingIndicator.remove();
        }

        // Toggle theme
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            const icon = themeToggle.querySelector('svg');
            icon.innerHTML = newTheme === 'dark' ? `
                <path d="M12 3C11.175 3 10.35 3.15 9.6 3.45C11.025 4.95 11.85 7.05 11.85 9.3C11.85 13.35 9 16.65 5.25 17.25C6.6 19.8 9.15 21.45 12 21.45C16.275 21.45 19.8 17.925 19.8 13.65C19.8 10.2 17.475 7.2 14.25 5.85C13.5 5.55 12.75 3 12 3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            ` : `
                <path d="M12 3V4M12 20V21M4 12H3M6.31412 6.31412L5.5 5.5M17.6859 17.6859L18.5 18.5M21 12H20M18.5 5.5L17.6859 6.31412M6.31412 17.6859L5.5 18.5M16 12C16 14.2091 14.2091 16 12 16C9.79086 16 8 14.2091 8 12C8 9.79086 9.79086 8 12 8C14.2091 8 16 9.79086 16 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            `;
        }

        // Load theme from localStorage
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            const icon = themeToggle.querySelector('svg');
            icon.innerHTML = savedTheme === 'dark' ? `
                <path d="M12 3C11.175 3 10.35 3.15 9.6 3.45C11.025 4.95 11.85 7.05 11.85 9.3C11.85 13.35 9 16.65 5.25 17.25C6.6 19.8 9.15 21.45 12 21.45C16.275 21.45 19.8 17.925 19.8 13.65C19.8 10.2 17.475 7.2 14.25 5.85C13.5 5.55 12.75 3 12 3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            ` : `
                <path d="M12 3V4M12 20V21M4 12H3M6.31412 6.31412L5.5 5.5M17.6859 17.6859L18.5 18.5M21 12H20M18.5 5.5L17.6859 6.31412M6.31412 17.6859L5.5 18.5M16 12C16 14.2091 14.2091 16 12 16C9.79086 16 8 14.2091 8 12C8 9.79086 9.79086 8 12 8C14.2091 8 16 9.79086 16 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            `;
        }

        // Save message to history
        function saveToHistory(message, sender, messageId, isHtml = false) {
            const timestamp = new Date().toISOString();
            
            const historyEntry = {
                id: messageId,
                timestamp,
                isHtml
            };
            
            if (sender === 'user') historyEntry.user = message;
            else historyEntry.bot = message;
            
            conversationHistory.push(historyEntry);
            localStorage.setItem('chatHistory', JSON.stringify(conversationHistory));
            updateHistoryDisplay();
        }

        // Load history from localStorage
        function loadHistory() {
            const savedHistory = localStorage.getItem('chatHistory');
            if (savedHistory) {
                conversationHistory = JSON.parse(savedHistory);
                renderHistory();
            }
        }

        // Render conversation history
        function renderHistory() {
            chatContainer.innerHTML = '';
            
            conversationHistory.forEach(entry => {
                if (entry.user) addMessageToChat(entry.user, 'user', entry.isHtml);
                if (entry.bot) addMessageToChat(entry.bot, 'bot', entry.isHtml);
            });
            
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Update history display
        function updateHistoryDisplay() {
            historyList.innerHTML = '';
            
            conversationHistory.forEach((entry, index) => {
                if (entry.user) {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    historyItem.innerHTML = `
                        <div class="history-item-time">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 8V12L15 15M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            ${formatTime(new Date(entry.timestamp))}
                        </div>
                        <div class="history-item-query">${entry.user}</div>
                        ${entry.bot ? `<div class="history-item-response">${truncateText(entry.bot.replace(/<[^>]*>/g, ''), 50)}</div>` : ''}
                    `;
                    
                    historyItem.addEventListener('click', () => {
                        chatContainer.innerHTML = '';
                        if (index === 0) addWelcomeMessage();
                        
                        for (let i = 0; i <= index; i++) {
                            const item = conversationHistory[i];
                            if (item.user) addMessageToChat(item.user, 'user', item.isHtml);
                            if (item.bot) addMessageToChat(item.bot, 'bot', item.isHtml);
                        }
                        
                        historyContainer.classList.remove('show');
                    });
                    
                    historyList.appendChild(historyItem);
                }
            });
        }

        // Load Q&A from localStorage
        function loadQA() {
            const savedQA = localStorage.getItem('qaKnowledgeBase');
            if (savedQA) qaKnowledgeBase = JSON.parse(savedQA);
        }

        // Clear chat history
        function clearChatHistory() {
            if (confirm('Are you sure you want to clear all chat history?')) {
                conversationHistory = [];
                localStorage.removeItem('chatHistory');
                updateHistoryDisplay();
                chatContainer.innerHTML = '';
                addWelcomeMessage();
                showToast('Chat history cleared');
            }
        }

        // Export chat history
        function exportChatHistory() {
            const historyText = conversationHistory.map(entry => {
                let text = '';
                if (entry.user) text += `You (${formatTime(new Date(entry.timestamp))}: ${entry.user}\n`;
                if (entry.bot) text += `Anushka.ai (${formatTime(new Date(entry.timestamp))}: ${entry.bot.replace(/<[^>]*>/g, '')}\n`;
                return text;
            }).join('\n');
            
            const blob = new Blob([historyText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `anushka-ai-chat-history-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Chat history exported');
        }

        // Load API settings from localStorage
        function loadApiSettings() {
            const savedSettings = localStorage.getItem('apiSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                Object.keys(settings).forEach(key => {
                    if (apiCheckboxes[key]) apiCheckboxes[key].checked = settings[key];
                });
            }
        }

        // Save API settings to localStorage
        function saveApiSettings() {
            const settings = {};
            Object.keys(apiCheckboxes).forEach(key => settings[key] = apiCheckboxes[key].checked);
            localStorage.setItem('apiSettings', JSON.stringify(settings));
        }

        // Read text aloud
        function readAloud(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                speechSynthesis.speak(utterance);
            } else {
                showToast('Text-to-speech not supported in your browser');
            }
        }

        // Copy text to clipboard
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast('Copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy:', err);
                showToast('Failed to copy');
            });
        }

        // Share message
        function shareMessage(text) {
            if (navigator.share) {
                navigator.share({
                    title: 'Anushka.ai Response',
                    text: text.replace(/<[^>]*>/g, ''),
                    url: window.location.href
                }).catch(err => {
                    console.error('Error sharing:', err);
                    showToast('Sharing failed');
                });
            } else {
                copyToClipboard(text);
                showToast('Copied to clipboard (sharing not supported)');
            }
        }

        // Show toast notification
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast-message';
            toast.textContent = message;
            toast.style.position = 'fixed';
            toast.style.bottom = '20px';
            toast.style.left = '50%';
            toast.style.transform = 'translateX(-50%)';
            toast.style.backgroundColor = 'var(--card-bg)';
            toast.style.color = 'var(--text-color)';
            toast.style.padding = '12px 24px';
            toast.style.borderRadius = '8px';
            toast.style.boxShadow = '0 4px 12px var(--shadow-color)';
            toast.style.zIndex = '1000';
            toast.style.opacity = '0';
            toast.style.transition = 'opacity 0.3s, transform 0.3s';
            toast.style.fontSize = '0.9rem';
            toast.style.fontWeight = '500';
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '1';
                toast.style.transform = 'translateX(-50%) translateY(-10px)';
            }, 10);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(-50%) translateY(-20px)';
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 3000);
        }

        // Format time
        function formatTime(date) {
            return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        // Truncate text
        function truncateText(text, maxLength) {
            return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
        }

        // Initialize the app
        init();
    </script>
</body>
</html>